<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Voodoo Shader Framework: Voodoo Shader Plugin Specifications</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="voodoo.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="voodoo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Voodoo Shader Framework
   &#160;<span id="projectnumber">framework-5.8</span>
   </div>
   <div id="projectbrief">Comprehensive shader support library</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Voodoo Shader Plugin Specifications </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Voodoo Shader core library is designed to provide a generic framework and certain Voodoo-specific features to help support shaders.</p>
<p>To allow additional features without breaking compatibility with other compilers or systems, Voodoo Shader provides a class-based plugin interface. Modules may be added and classes provided by those modules created and used within Voodoo or adapters. To handle loading these modules, a known interface is required with a few specific features.</p>
<h2><a class="anchor" id="voodoo_spec_plugin_exports"></a>
Module Exports</h2>
<p>Each Voodoo Shader module must export a set of 4 functions. These are used by the core to load and query the module's version and what classes it provides. All these functions must be exported by name only, with no mangling or decoration of any kind.</p>
<h3><a class="anchor" id="voodoo_spec_plugin_exports_version"></a>
PluginInit</h3>
<div class="fragment"><pre class="fragment"> <span class="keyword">const</span> Version * PluginInit(ICore * pCore); 
</pre></div><p>The <code>PluginInit</code> function performs any initialization the plugin needs to do and, if successful, returns a constant VersionDesc struct with the module's name, version and various flags. If the initialization fails, the plugin must return a nullptr, and loading will be aborted and the DLL unloaded from the process.</p>
<p>To allow plugins to register callbacks, <em>pCore</em> is given. <code>PluginInit</code> is typically called during the call to <a class="el" href="class_voodoo_shader_1_1_i_core.html#aa3228d23a95ebf0065bb679b1c3f516f" title="Initializes the core, loading the config file and all required modules and creating objects...">ICore::Init()</a>, so plugins <em>must</em> assume the core has not yet been initialized and must not call methods requiring init to have completed. If the plugin requires initialization using the complete core, it should register a callback to the EventIds::Finalize event, which will be called at the end of <a class="el" href="class_voodoo_shader_1_1_i_core.html#aa3228d23a95ebf0065bb679b1c3f516f" title="Initializes the core, loading the config file and all required modules and creating objects...">ICore::Init()</a>.</p>
<h3><a class="anchor" id="voodoo_spec_plugin_exports_count"></a>
ClassCount</h3>
<div class="fragment"><pre class="fragment"> <span class="keyword">const</span> uint32_t ClassCount(); 
</pre></div><p>Returns the total number of classes publicly exposed by this module. This may be 0, as adapters commonly do not expose public classes.</p>
<h3><a class="anchor" id="voodoo_spec_plugin_exports_info"></a>
ClassInfo</h3>
<div class="fragment"><pre class="fragment"> <span class="keyword">const</span> <span class="keywordtype">wchar_t</span> * ClassInfo(<span class="keyword">const</span> uint32_t index, <a class="code" href="group__voodoo__classes__conditional.html#gab57c2748ff90ac8bfd490f12ccc43cc5">Uuid</a> * pClsid); 
</pre></div><p>Returns the name and ClsId of a class. This is used to register the classes in the core's module manager when the module is loaded. The return value must be a pointer to the class name or nullptr if the index is invalid, and the clsid parameter must be filled with the ClsId or unchanged if the index is invalid.</p>
<p>If <em>index</em> is greater than or equal to the value returned by this plugin's <code>ClassCount</code>, <code>ClassInfo</code> must return nullptr. Class order must be constant throughout the plugin's lifetime and over multiple uses, and the values given in <em>ClassInfo</em> and class returned by <em>ClassCreate</em> must match.</p>
<h3><a class="anchor" id="voodoo_spec_plugin_exports_create"></a>
ClassCreate</h3>
<div class="fragment"><pre class="fragment"> IObject * ClassCreate(<span class="keyword">const</span> uint32_t index, ICore * pCore); 
</pre></div><p>Creates a new instance of the given class, bound to the provided core.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Class constructors <em>may</em> throw exceptions, but these must be caught within the create function and <em>must not</em> be allowed to propagate between modules (this can cause crashes). If an error occurs, a nullptr must be returned; if the core given has a logger attached, the class constructor or create function <em>may</em> use that to log error information.</dd>
<dd>
Any class provided by this module that may be created externally by this function must be listed in ClassInfo using the same index.</dd></dl>
<h2><a class="anchor" id="voodoo_spec_iobject"></a>
IObject Interface</h2>
<p>Every class used in Voodoo Shader <em>must</em> derive from the <a class="el" href="class_voodoo_shader_1_1_i_object.html" title="Defines a simple interface all Voodoo objects from dynamic modules must inherit.">IObject</a> interface. The methods provided are vital for object lifetime management and garbage collection. This is performed in a manner very much like COM, with each object managing reference count internally.</p>
<p>Every object, except one which implements <a class="el" href="class_voodoo_shader_1_1_i_core.html" title="ICore engine class for the Voodoo Shader Framework.">ICore</a>, must hold a non-incremented reference to its core and may hold a non-incremented reference to its immediate parent. This allows tracking up without causing circular references. The object may both temporarily increment the reference, when it needs a short-term guarantee of validity, or pass the reference (where it may be incremented). However, in no other case may non-incremented references be used; this can break thread-safety, cause crashes, and undefined behavior.</p>
<h3><a class="anchor" id="voodoo_spec_iobject_addref"></a>
IObject::AddRef</h3>
<div class="fragment"><pre class="fragment"> uint32_t <a class="code" href="class_voodoo_shader_1_1_i_object.html#ac2068042dc47a035d13e62b3b44689de" title="Add a reference to this object.">IObject::AddRef</a>() CONST 
</pre></div><p>Increments the internal reference count by 1 and returns the new count, no other effects shall be caused. Any call to <code>AddRef</code> must have a matching call to <code>Release</code>; these may be handled by a smart pointer (such as boost's intrusive_ptr). Calls to this will always be thread-safe.</p>
<h3><a class="anchor" id="voodoo_spec_iobject_release"></a>
IObject::Release</h3>
<div class="fragment"><pre class="fragment"> uint32_t <a class="code" href="class_voodoo_shader_1_1_i_object.html#a25f4c19470849e4679e0afc5ac7bfd02" title="Release a reference from this object.">IObject::Release</a>() CONST 
</pre></div><p>Decrements the internal reference count by 1 and returns the new count. If the new count is 0, the object must be deleted internally before the function returns (<code>delete this;</code>), no other effects shall be caused. This guarantees correct memory allocation and deallocation, safe from compiler or module boundaries. Calls to this will always be thread-safe.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>As <code>AddRef</code> and <code>Release</code> require no other effects, it may be necessary to provide initialization and/or reset functions, as <a class="el" href="class_voodoo_shader_1_1_i_core.html" title="ICore engine class for the Voodoo Shader Framework.">ICore</a> does. This helps provide more information and safety during the setup and teardown process.</dd></dl>
<h3><a class="anchor" id="voodoo_spec_iobject_query"></a>
IObject::QueryInterface</h3>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__voodoo__types.html#ga55c78202cdb91499a486ffec0bdc4e9e" title="Standard return type for Voodoo Shader functions, indicating various levels of success or failure...">VoodooResult</a> <a class="code" href="class_voodoo_shader_1_1_i_object.html#a63b6c4587242c7486a07eb4233beda0f" title="Performs type checking internally, then provides a pointer to this object with the desired interface ...">IObject::QueryInterface</a>(CONST <a class="code" href="group__voodoo__classes__conditional.html#gab57c2748ff90ac8bfd490f12ccc43cc5">Uuid</a> refid, IObject ** ppOut) 
</pre></div><p>Queries the object for a particular interface. This is used for a variety of purposes, including extended polymorphism and object identification. For example, IModule::CreateObject() returns a generic <a class="el" href="class_voodoo_shader_1_1_i_object.html" title="Defines a simple interface all Voodoo objects from dynamic modules must inherit.">IObject</a>, which can be safely checked for a desired interface by calling <code>QueryInterface</code>, without resorting to dangerous casts.</p>
<p>If <em>ppOut</em> is a nullptr, the call must fail with invalid parameters (VSFERR_INVALIDPARAMS).</p>
<p>If <em>refid</em> is not a nil Uuid and the object implements the interface passed in <em>refid</em> or if <em>refid</em> is the object's ClsId, it must place a pointer providing that interface into <em>ppOut</em> and return <em>VSF_OK</em>. The pointer must evaluate equal to any other pointer to the same object, regardless of interface. The object's reference count must be incremented, from the pointer to be returned.</p>
<p>If the object does not implement the class or interface in <em>refid</em>, the call must fail with an invalid Uuid error (VSFERR_INVALIDUUID).</p>
<p>All IObject-derived classes must provide interfaces for <a class="el" href="class_voodoo_shader_1_1_i_object.html" title="Defines a simple interface all Voodoo objects from dynamic modules must inherit.">IObject</a>, their parent interface(s), and their class. Calls to <code>QueryInterface</code> must be symmetric (if <code>QI(A)-&gt;B</code> succeeds, then <code>QI(QI(A)-&gt;B)-&gt;A</code> must as well), transitive (if <code>QI(QI(A)-&gt;B)-&gt;C</code> succeeds, then <code>QI(A)-&gt;C</code> must as well), and reflexive (<code>QI(A)-&gt;A</code> must always succeed).</p>
<p>This is not to say that all objects of type <code>A</code> must behave the same; these guarantees must hold for any single object throughout its lifetime. Two objects of type <code>A</code> may be unable to provide an interface based on internal conditions (for example, if <code>A1</code> is an <a class="el" href="class_voodoo_shader_1_1_i_object.html" title="Defines a simple interface all Voodoo objects from dynamic modules must inherit.">IObject</a> queried from an <a class="el" href="class_voodoo_shader_1_1_i_core.html" title="ICore engine class for the Voodoo Shader Framework.">ICore</a> and <code>A2</code> is an <a class="el" href="class_voodoo_shader_1_1_i_object.html" title="Defines a simple interface all Voodoo objects from dynamic modules must inherit.">IObject</a> queried from an <a class="el" href="class_voodoo_shader_1_1_i_parser.html" title="Provides extensive variable handling and string parsing.">IParser</a>, <code>A2</code> will not be able to provide an interface to <a class="el" href="class_voodoo_shader_1_1_i_core.html" title="ICore engine class for the Voodoo Shader Framework.">ICore</a>, but must be able to do so for <a class="el" href="class_voodoo_shader_1_1_i_parser.html" title="Provides extensive variable handling and string parsing.">IParser</a>).</p>
<p>For <a class="el" href="class_voodoo_shader_1_1_v_s_core.html">VSCore</a> (which implements <a class="el" href="class_voodoo_shader_1_1_i_core.html" title="ICore engine class for the Voodoo Shader Framework.">ICore</a> and <a class="el" href="class_voodoo_shader_1_1_i_object.html" title="Defines a simple interface all Voodoo objects from dynamic modules must inherit.">IObject</a>) an example QueryInterface may be:</p>
<div class="fragment"><pre class="fragment"> <span class="keywordflow">if</span> (!ppOut)
 {
     <span class="keywordflow">return</span> <a class="code" href="group__voodoo__types__codes.html#ga7b155c8e47b751d99be277c07d4cf230">VSFERR_INVALIDPARAMS</a>;
 } 
 <span class="keywordflow">else</span> 
 {
     <span class="keywordflow">if</span> (clsid == <a class="code" href="group__voodoo__interfaces.html#ga62817948333934d8276718972fd0e817">IID_IObject</a>)
     {
         *ppOut = <span class="keyword">static_cast&lt;</span>IObject*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);
     }
     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (clsid == <a class="code" href="group__voodoo__interfaces.html#ga6ae0f2c64cbfa194d74ded2df76eb719">IID_ICore</a>)
     {
         *ppOut = <span class="keyword">static_cast&lt;</span>ICore*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);
     }
     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (clsid == <a class="code" href="namespace_voodoo_shader.html#a6652e64c0b89642758fcf645575cf44e" title="ICore engine class for the Voodoo Shader Framework.">CLSID_VSCore</a>)
     {
         *ppOut = <span class="keyword">static_cast&lt;</span>VSCore*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);
     }
     <span class="keywordflow">else</span>
     {
         *ppOut = <span class="keyword">nullptr</span>;
         <span class="keywordflow">return</span> vSFERR_INVALIDUUID;
     }
     (*ppOut)-&gt;AddRef();
     <span class="keywordflow">return</span> <a class="code" href="group__voodoo__types__codes.html#ga1e2edce1678d8e28e0cc7d49c7d42ad3">VSF_OK</a>;
 }
</pre></div><h3><a class="anchor" id="voodoo_spec_iobject_tostring"></a>
IObject::ToString</h3>
<div class="fragment"><pre class="fragment"> String <a class="code" href="class_voodoo_shader_1_1_i_object.html#a29869a5e16e29398ae21bb925bc9633c" title="Get a string identifying this object.">IObject::ToString</a>() CONST 
</pre></div><p>Returns a formatted string made up of the object's type <em>name</em> (which may be the object's ClsId, although this is not recommended) and optionally some data. This string must follow the form:</p>
<div class="fragment"><pre class="fragment"> ImplName()
 ImplName(Key: Value; Key: Value)
</pre></div><p>If no data is provided, the data section inside the parentheses must be empty but the parentheses must be present. If data is provided, it must be in a <code>(key: value[; ...])</code> form with all colons, semicolons, quotes and parantheses escaped (prefixed with a backslash).</p>
<h3><a class="anchor" id="voodoo_spec_iobject_getcore"></a>
IObject::GetCore</h3>
<div class="fragment"><pre class="fragment"> ICore * <a class="code" href="class_voodoo_shader_1_1_i_object.html#ac04f1b9452f6e8269b77b12df8fa1bc9" title="Get the core this object was associated with.">IObject::GetCore</a>() CONST 
</pre></div><p>Returns a reference to the object's parent core.</p>
<h3><a class="anchor" id="voodoo_spec_plugin_throw"></a>
throw()</h3>
<p><b>Methods and functions in any class or interface derived from <a class="el" href="class_voodoo_shader_1_1_i_object.html" title="Defines a simple interface all Voodoo objects from dynamic modules must inherit.">IObject</a> shall not throw exceptions or allow them to propogate out from the function.</b> If error reporting is necessary, an error value should be returned and the exception logged. This is a necessary safety precaution, as modules may be created with different compilers or languages and it may not be possible to safely pass exceptions.</p>
<p>Methods which call other functions that may throw (such as standard library functions) must catch and handle any potential exception and prevent it from propagating. Constructors may throw, and all calls to <code>new</code> should be wrapped in try/catch blocks to handle both exceptions from the ctor and various other exceptions (such as memory).</p>
<h2><a class="anchor" id="voodoo_spec_plugin_docs"></a>
Documentation</h2>
<p>If possible, module creators should provide full documentation for modules, including class names and interfaces implemented from each.</p>
<p>The Voodoo Shader project offers hosting for this documentation on the Github project site. Modules may request a wiki page and space for doxygen-generated documents, which will be fully linked into the main project. Modules not wishing to be on the main project may instead request a link to other documentation. </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Sun Jan 22 2012 18:43:33 for Voodoo Shader Framework by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
