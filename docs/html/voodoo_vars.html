<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Voodoo Shader Framework: Variables</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="voodoo.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="voodoo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Voodoo Shader Framework
   &#160;<span id="projectnumber">framework-5.8</span>
   </div>
   <div id="projectbrief">Comprehensive shader support library</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Variables </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Voodoo core provides a simple variable parser for use in path resolution or other string usage.</p>
<p>The syntax and use of these variables is described in this page.</p>
<h2><a class="anchor" id="voodoo_vars_syntax"></a>
Syntax</h2>
<p>Variables are used by inserting <code>$(variable)</code> tokens into a string. Each variable will be removed and replaced with the value currently assigned to it. Variables are parsed when used, allowing delayed resolution and recursion. Variables are replaced innermost to outermost and left to right (see examples below). Four levels of priority are used in parsing. Builtin variables are searched first, then state variables, then regular variables, and finally environment variables supplied by the system.</p>
<h3><a class="anchor" id="voodoo_vars_syntax_names"></a>
Variable Names</h3>
<p>Variable names may contain any characters not listed to have a special meaning; these characters will be stripped before the name is used. Variable names may contain variables, with the full syntax, but these are parsed when the variable is added to the parser (rather than when used, as values are).</p>
<h4><a class="anchor" id="voodoo_vars_syntax_names_spec"></a>
Variable Flags &amp; Modes</h4>
<ul>
<li>The '!' character indicates required variables, which are replaced with an error note if they are not found. </li>
<li>The '~' character indicates delayed variables, which do not have their value parsed (and so may contain other variables without replacements). This can be useful when building variable variables to avoid recursion constraints. </li>
<li>The '@' character indicates recursive flags. The '@' must be followed by a number, which may be prefixed with '-' or '+' and followed by a space. If no symbol is given, the flags replace those given to the parse call; if '+' the flags are added (logical OR) and if '-' the flags are removed (logical XOR). </li>
<li>The ':' character indicates state variables, described below.</li>
</ul>
<p>These flags can be combined, but must appear in the order given. With the exception of the state delimiter (':'), flags must begin at the start of the variable and no other content may come before the end of the flags.</p>
<h3><a class="anchor" id="voodoo_vars_syntax_value"></a>
Variable Values</h3>
<p>Variable values may contain any characters and embedded variables. Values are parsed when used, using the current state and flags (in contrast to names, which are parsed when added).</p>
<h3><a class="anchor" id="voodoo_vars_syntax_state"></a>
Variable States &amp; Recursion</h3>
<p>Each parsing call creates a state block and uses a discrete depth counter. The depth counter handles recursion and operated very simply. Each time the parser encounters a string that requires parsing, the counter is incremented and passed on. The recursion limit is implementation-defined, with <a class="el" href="class_voodoo_shader_1_1_v_s_parser.html">VSParser</a> using 8. When this limit is reached, variables will not be parsed, preventing infinite loops.</p>
<p>State blocks are somewhat more Cthulhic in their logic. When the parser is called, a state block is created and passed on, similar to the depth counter. However, if a variable name containing a ':' character is encountered, the state may change. The variable name in question will be split at the ':' into a new name and value, both of which will be parsed using the current state. The returned values will be inserted into the state block as a new variable (or to overwrite an existing state variable). State variable may then be used in future parsing. While intended for relatively simple dynamic strings, state variables can (with sufficient cleverness and masochism) be used to perform simple logic operations.</p>
<dl class="user"><dt><b>Examples:</b></dt><dd><div class="fragment"><pre class="fragment"> localroot = M:\VoodooShader\
 gempath = M:\VoodooShader\Gem\
 resourcedir = \resources\

 $(localroot)\subdir\file.png = M:\VoodooShader\\subdir\file.png
 $(gempath)\shaders\test.fx = M:\VoodooShader\Gem\\shaders\test.fx
 $(localroot)\$(resourcedir)\image.dds = M:\VoodooShader\\\resources\\image.dds
</pre></div></dd></dl>
<p>Variable names may also contain variables (as mentioned above). The syntax is identical, but the results are slightly more complex.</p>
<dl class="user"><dt><b>Examples: (with VSParse_SingleSlash | VSParse_BackslashOnly)</b></dt><dd><div class="fragment"><pre class="fragment"> basepath = M:\VoodooShader\
 adapter = Frost
 Frost_respath = /resources/frost/

 $(basepath)/$($(adapter)_respath) = M:\VoodooShader\resources\frost\
</pre></div></dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Repeated consecutive slashes will not cause errors with path parsing, although in some locations they have special meanings. They may cause errors when using the string for other reasons; calling <a class="el" href="class_voodoo_shader_1_1_i_parser.html#a0a5ea71bb0add834ec4de677d0f56b12">IParser::Parse()</a> with the <a class="el" href="group__voodoo__enums.html#gga97ffa79fd7512cffa1f0bce04ec778ceabf2d4b9ab2a12075f66e884f6442b2ce">VSParse_SlashSingle</a> flag set will attempt to strip these. Finally, state variables and suppression use a variation on the name syntax.</dd></dl>
<dl class="user"><dt><b>Examples:</b></dt><dd><div class="fragment"><pre class="fragment"> basepath = M:\VoodooShader\
 game.exe = $(adapter:Gem)
 Gem_Adapter = Voodoo_Gem.dll
 _Adapter = Voodoo_Core.dll

 $(target) = game.exe
 $(?$(target)_Adapter) = $(Gem_Adapter) = Voodoo_Gem.dll

 $(target) = test.exe
 $(?$(target)_Adapter) = $(_Adapter) = Voodoo_Core.dll
 $($(target)_Adapter) = $(badvar:test.exe_Adapter)
</pre></div></dd></dl>
<h2><a class="anchor" id="voodoo_vars_sys"></a>
System Variables</h2>
<p>Some variables, typically built-ins, are marked as system variables. These may be added once and may not be overwritten or later changed (all other variables may be changed by overwriting the name). The <a class="el" href="class_voodoo_shader_1_1_i_parser.html#a9e626cc6bd961e559fb62f0fdf708494">IParser::Remove()</a> method does not remove system variables.</p>
<h2><a class="anchor" id="voodoo_vars_flags"></a>
Flags</h2>
<p>The variable parser provides a small set of flags to control parsing modes.</p>
<h3><a class="anchor" id="voodoo_vars_flags_slash_single"></a>
VSParse_SingleSlash</h3>
<p>Removes repeated slashes, both forward and back. This processes each stage of the string before it is returned up a level, and is typically very reliable (even if variables place new slashes).</p>
<h3><a class="anchor" id="voodoo_vars_flags_slash_type"></a>
VSParse_SlashOnly &amp; VSParse_BackslashOnly</h3>
<p>Replaces all slashes with a single type (forward or back). This may be necessary; XPath syntax, for example, uses forward slashes while Windows paths tend to prefer backslashes. These may not be combined.</p>
<h3><a class="anchor" id="voodoo_vars_flags_case"></a>
VSParse_Lowercase &amp; VSParse_Uppercase</h3>
<p>Transforms the string into a specific case. All alphabetic characters (a-z and A-Z) will be replaced with the given case.</p>
<h2><a class="anchor" id="voodoo_vars_error"></a>
Errors</h2>
<p>If a variable cannot be resolved, an error value will be used in place of the variable. This value is designed to cause the path to fail in any operations. The error value will replace <code>varname</code> with <code>badvar:varname</code>.</p>
<h2><a class="anchor" id="voodoo_vars_builtin"></a>
Built-In Variables</h2>
<p>A small assortment of built-in variables are provided for use. These represent system or environment paths that may be important. These will be marked here with a note of the earliest version of the framework in which they are provided. Adapters and other modules may also add system variables, but these can never overwrite other system variables.</p>
<h3><a class="anchor" id="voodoo_vars_builtin_path"></a>
$(path)</h3>
<p>The global root path of Voodoo. This is the main Voodoo folder, containing most global resources and binaries. This path is retrieved from the registry by the Voodoo loader. The value is \-terminated.</p>
<dl class="user"><dt><b>Example:</b></dt><dd><div class="fragment"><pre class="fragment"> $(path)\framework\bin\ = Voodoo binary path
</pre></div></dd></dl>
<h3><a class="anchor" id="voodoo_vars_builtin_local"></a>
$(local)</h3>
<p>The path of the target executable, that is, the program that Voodoo is loaded into. This is the absolute path to the file, without the filename. This path is retrieved from the Windows API during startup. The value is \-terminated.</p>
<dl class="user"><dt><b>Example:</b></dt><dd><div class="fragment"><pre class="fragment"> TargetEXE = H:\Program\Program.exe
 $(localroot) = H:\Program\
</pre></div></dd></dl>
<h3><a class="anchor" id="voodoo_vars_builtin_startup"></a>
$(startup)</h3>
<p>The initial working path for Voodoo. This is the directory that the target was started in (the startup working directory). This path is retrieved from the Windows API by the loader during startup. This is the most variable of the builtin variables; it may change each run, depending on how the target is started. The value is \-terminated.</p>
<h3><a class="anchor" id="voodoo_vars_builtin_target"></a>
$(target)</h3>
<p>The filename of the target application. This does not include the path (found in <code>$(localroot)</code>), only the name. To help use this for variable varnames, this is forced to all lowercase. You can use it to change the config settings based on the running executable, like so:</p>
<dl class="user"><dt><b>Example: Two adapter names, for different games. For this example, the running target is</b></dt><dd><code>nwmain.exe</code>. <div class="fragment"><pre class="fragment"> globalroot = M:\VoodooShader\
 target = nwmain.exe
 morrowind.exe = Gem
 nwmain.exe = Frost
 adapter = $($(target))

 $(adapter)_Adapter = Frost_Adapter
 $(globalroot)\resources\$(adapter) = M:\VoodooShader\resources\Frost
</pre></div></dd></dl>
<p>The variable used in adapter (and so, the value) change depending on the value of target.</p>
<h3><a class="anchor" id="voodoo_vars_builtin_prefix"></a>
$(prefix)</h3>
<p>The binary directory prefix. By default, or if not specified, this is </p>
<div class="fragment"><pre class="fragment"> bin\\
</pre></div><p>. Otherwise, this takes a user-defined value. This is used within the framework to allow specifying a particular set of binaries, especially for debugging (set prefix to </p>
<div class="fragment"><pre class="fragment"> debug\\
</pre></div><p> and temporarily load debug binaries).</p>
<h3><a class="anchor" id="voodoo_vars_builtin_binpath"></a>
$(binpath)</h3>
<p>The framework binary directory. This is always </p>
<div class="fragment"><pre class="fragment"> $(path)\\$(module)\\$(prefix) 
</pre></div><p>, provided as a convenience. By default, </p>
<div class="fragment"><pre class="fragment"> $(module) 
</pre></div><p> always takes the value <code>framework</code>, but can be overwritten by state variables.</p>
<h3><a class="anchor" id="voodoo_vars_builtin_args"></a>
$(args), $(argc), $(argv_&lt;em&gt;N&lt;/em&gt;)</h3>
<p>This set of variables describe the command line arguments passed to the target. </p>
<div class="fragment"><pre class="fragment"> $(args) 
</pre></div><p> is the full command line string, all arguments as passed. The others match their use in the traditional C main function, with </p>
<div class="fragment"><pre class="fragment"> $(argc) 
</pre></div><p> containing the number of arguments and </p>
<div class="fragment"><pre class="fragment"> $(argv) 
</pre></div><p> containg the arguments. As variables do not support arrays, the argument index is appended, as </p>
<div class="fragment"><pre class="fragment"> $(argv_0) 
</pre></div><p>.</p>
<h2><a class="anchor" id="voodoo_vars_config"></a>
Config Variables</h2>
<p>When the core loads, it retrieves any variables from the config (using the XPath query "/VoodooConfig/Variables/Variable"). These variables must have a <code>name</code> attribute and text. They are added to the variable list, but not parsed until used.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Variables with identical names will overwrite their previous value. The built-in variables cannot be overwritten.</dd></dl>
<h2><a class="anchor" id="voodoo_vars_environ"></a>
Environment Variables</h2>
<p>If a variable name is given that cannot be found in the list of loaded and built-in variables, it will be assumed to be an environment variable. These variables are pulled directly from the process' environment and so are system-dependent. They may or may not be useful.</p>
<dl class="warning"><dt><b>Warning:</b></dt><dd>Care should be taken while using environment variables; config variables are much preferred. Environment variables should only be used when sharing paths between applications or throughout the system is needed. </dd></dl>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Sun Jan 22 2012 15:07:05 for Voodoo Shader Framework by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
